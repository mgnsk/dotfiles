#!/usr/bin/env bash

set -euo pipefail

target="$1"
number="$2"

if [ "$number" == "" ]; then
	echo "number argument empty"
	exit 1
fi

source "$(dirname "$0")/gh-lib/pr.sh"
source "$(dirname "$0")/gh-lib/issue.sh"
source "$(dirname "$0")/gh-lib/templates.sh"

if [ "$target" == "pr" ]; then
	gh api graphql -F owner='{owner}' -F name='{repo}' -F number="$number" -f query="$pr_query" --jq "$pr_jq_template" | gh-tpl "$issue_pr_go_template" | render-markdown
	# gh pr diff "$number" | delta
elif [ "$target" == "issue" ]; then
	gh api graphql -F owner='{owner}' -F name='{repo}' -F number="$number" -f query="$issue_query" --jq "$issue_jq_template" | gh-tpl "$issue_pr_go_template" | render-markdown
else
	echo "usage: gh-view {pr|issue} {number}"
	exit 1
fi
