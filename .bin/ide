#!/bin/env bash

set -eu

args=(
	--dev-bind /dev /dev
	--proc /proc
	--tmpfs /tmp
	--tmpfs "/run/user/$(id -u)"
	--ro-bind /bin /bin
	--ro-bind /usr /usr
	--ro-bind /lib /lib
	--ro-bind /lib64 /lib64
	--ro-bind /etc /etc
	--setenv USERHOST_COLOR '\[\e[0;33m\]'
	--bind "$PWD" "$PWD"
	--bind "$HOME/.cache" "$HOME/.cache"
	--bind "$HOME/.local" "$HOME/.local"
	--bind "$HOME/go" "$HOME/go"
	--bind "$HOME/.cargo" "$HOME/.cargo"
)

# Bind mount all files tracked by dotfiles git.
for f in $(git -C "$HOME" ls-tree -r master --name-only); do
	args+=(
		--ro-bind "$HOME/$f" "$HOME/$f"
	)
done

bwrap "${args[@]}" /usr/bin/bash
