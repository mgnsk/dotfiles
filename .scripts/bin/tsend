#!/bin/env bash

set -euo pipefail

FILES=$(fzf --multi)
SUFFIX=$(tailscale status --json | gojq -r '.CurrentTailnet.MagicDNSSuffix')
PEER=$(tailscale status --json | gojq -r ".Peer[].DNSName | rtrimstr(\".$SUFFIX.\")" | fzf)

OIFS="$IFS"
IFS=$'\n'
for file in $FILES; do
	echo "Sending $file to $PEER"
	tailscale file cp "$file" "$PEER:"
done
IFS="$OIFS"
