---
interpreter: bash -eu -o pipefail -c

tasks:
  install:
    usage: Install tools.
    run:
      - command: rustup default nightly
      - command: rustup component add rustfmt rust-src clippy rust-analyzer-preview
      - command: composer install --no-dev --no-cache --no-interaction --optimize-autoloader
      - command: >
          nvim --headless -u NORC
          -c 'lua if not require("plugins") then os.exit(1) end'
          -c 'lua local ok, result = pcall(vim.cmd, "Lazy! restore"); if not ok then os.exit(1) end'
          -c 'lua os.exit(0)'
      - command: fish -c "fish_update_completions"
