#!/usr/bin/env bash

set -euo pipefail

user=$(id -un)
tz=$(timedatectl show | grep Timezone | cut -d= -f2)
pwd=$(pwd)

docker volume create ide-go || true
docker volume create ide-cargo || true
docker volume create ide-fish-history || true
docker run \
	--init \
	--interactive \
	--tty \
	--rm \
	--pull=never \
	--env TERM="$TERM" \
	--env TZ="$tz" \
	--env TOOLBOX_ENV=true \
	--hostname toolbox \
	--network host \
	--tmpfs /tmp:rw,exec,nosuid,nodev,mode=777 \
	--tmpfs "/home/$user/.local/state:rw,exec,nosuid,nodev,mode=777" \
	--tmpfs "/home/$user/.cache:rw,noexec,nosuid,nodev,mode=777" \
	--volume "ide-go:/home/$user/go" \
	--volume "ide-cargo:/home/$user/.cargo" \
	--volume "ide-fish-history:/home/$user/.local/share/fish" \
	--volume "$pwd:$pwd:Z" \
	--workdir "$pwd" \
	toolbox:latest \
	fish
