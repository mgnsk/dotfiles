---
options:
  uid:
    default:
      command: id -u
  gid:
    default:
      command: id -g
  user:
    default:
      command: id -u -n
  group:
    default:
      command: id -g -n

tasks:
  build:
    usage: Build the toolbox.
    run:
      - command: >
          docker-compose
          -p toolbox
          build
          --pull
          --build-arg uid=${uid}
          --build-arg gid=${gid}
          --build-arg user=${user}
          --build-arg group=${group}
      - command: docker image prune -f

  shell:
    usage: Run a user shell in the toolbox.
    run:
      - command: docker-compose -p toolbox up -d --no-recreate toolbox
      - command: docker-compose -p toolbox exec toolbox /usr/bin/fish

  down:
    usage: Stop the toolbox.
    run:
      - command: docker-compose -p toolbox down --remove-orphans

  clean:
    usage: Stop the toolbox and remove columes.
    run:
      - command: docker-compose -p toolbox down --remove-orphans -v
